{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0b3", "generated_at": "2025-11-10T06:54:32.240923Z", "invocation_id": "f63e6eb9-17cb-435e-b032-465b3060ddbc", "invocation_started_at": "2025-11-10T06:54:19.170490Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T06:54:27.094410Z", "completed_at": "2025-11-10T06:54:27.105433Z"}, {"name": "execute", "started_at": "2025-11-10T06:54:27.105924Z", "completed_at": "2025-11-10T06:54:29.895637Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.804438591003418, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "njc-ezpass", "job_id": "0ed9fc41-c870-4faf-8fa0-c8caecf73b89", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ezpass_dbt.silver", "compiled": true, "compiled_code": "\n\nWITH  __dbt__cte___silver__cleaning as (\n\n\nWITH source AS (\n    SELECT * FROM `njc-ezpass`.`ezpass_data`.`bronze`\n),\n\ncleaned AS (\n    SELECT\n        -- Convert dates (STRING YYYY-MM-DD \u2192 DATE)\n        SAFE.PARSE_DATE('%Y-%m-%d', transaction_date) as transaction_date,\n        SAFE.PARSE_DATE('%Y-%m-%d', posting_date) as posting_date,\n        \n        -- Convert timestamps (STRING YYYY-MM-DD HH:MM:SS \u2192 TIMESTAMP)\n        SAFE.PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', entry_time) as entry_time,\n        SAFE.PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', exit_time) as exit_time,\n        \n        -- Clean and standardize text fields (replace '-' with NULL)\n        NULLIF(UPPER(TRIM(tag_plate_number)), '-') as tag_plate_number,\n        NULLIF(UPPER(TRIM(agency)), '-') as agency,\n        NULLIF(TRIM(description), '-') as description,\n        NULLIF(UPPER(TRIM(entry_plaza)), '-') as entry_plaza,\n        NULLIF(TRIM(entry_lane), '-') as entry_lane,\n        NULLIF(UPPER(TRIM(exit_plaza)), '-') as exit_plaza,\n        NULLIF(TRIM(exit_lane), '-') as exit_lane,\n        NULLIF(TRIM(vehicle_type_code), '-') as vehicle_type_code,\n        NULLIF(TRIM(plan_rate), '-') as plan_rate,\n        NULLIF(TRIM(prepaid), '-') as prepaid,\n        NULLIF(TRIM(fare_type), '-') as fare_type,\n        \n        -- Convert numeric fields (STRING \u2192 FLOAT64)\n        SAFE_CAST(amount AS FLOAT64) as amount,\n        SAFE_CAST(balance AS FLOAT64) as balance,\n        \n        -- Keep metadata\n        SAFE.PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', loaded_at) as loaded_at,\n        source_file\n        \n    FROM source\n    WHERE transaction_date IS NOT NULL  -- Filter out bad records\n)\n\nSELECT * FROM cleaned\n),  __dbt__cte___silver__enrichment as (\n\n\nWITH cleaned AS (\n    SELECT * FROM __dbt__cte___silver__cleaning\n),\n\nenriched AS (\n    SELECT\n        *,\n        \n        -- Agency name enrichment\n        CASE agency\n            WHEN 'GSP' THEN 'Garden State Parkway'\n            WHEN 'NJTP' THEN 'New Jersey Turnpike'\n            WHEN 'SJ' THEN 'South Jersey Transportation Authority'\n            WHEN 'PTC' THEN 'Pennsylvania Turnpike Commission'\n            WHEN 'DRJTBC' THEN 'Delaware River Joint Toll Bridge Commission'\n            WHEN 'DRPA' THEN 'Delaware River Port Authority'\n            WHEN 'PANYNJ' THEN 'Port Authority of NY & NJ'\n            WHEN 'BCBC' THEN 'Burlington County Bridge Commission'\n            WHEN 'NJ E-ZPASS' THEN 'NJ E-ZPass (back office)'\n            WHEN 'CBDTP' THEN 'Central Business District Tolling Program'\n            WHEN 'DELDOT' THEN 'Delaware Department of Transportation'\n            WHEN 'DRBA' THEN 'Delaware River & Bay Authority'\n            WHEN 'ILTOLL' THEN 'Illinois Tollway Authority'\n            WHEN 'ITRCC' THEN 'Indiana Toll Road Concession Company'\n            WHEN 'MASSDOT' THEN 'Massachusetts Department of Transportation'\n            WHEN 'MDTA' THEN 'Maryland Transportation Authority'\n            WHEN 'META' THEN 'Maine Turnpike Authority'\n            WHEN 'MTAB&T' THEN 'MTA Bridges and Tunnels'\n            WHEN 'NHDOT' THEN 'New Hampshire Department of Transportation'\n            WHEN 'NYSBA' THEN 'New York State Bridge Authority'\n            WHEN 'NYSTA' THEN 'New York State Bridge Authority'\n            WHEN 'OTIC' THEN 'Ohio Turnpike and Infrastructure Commission'\n            WHEN 'VDOT' THEN 'Virginia Department of Transportation'\n            ELSE NULL  -- Unknown values become NULL\n        END as agency_name,\n\n        -- State's abbreviation name\n        CASE agency\n            WHEN 'GSP' THEN 'NJ'\n            WHEN 'NJTP' THEN 'NJ'\n            WHEN 'SJ' THEN 'NJ'\n            WHEN 'PTC' THEN 'PA'\n            WHEN 'DRJTBC' THEN 'PA'\n            WHEN 'DRPA' THEN 'PA'\n            WHEN 'PANYNJ' THEN 'NY'\n            WHEN 'BCBC' THEN 'PA'\n            WHEN 'NJ E-ZPASS' THEN 'NJ'\n            WHEN 'CBDTP' THEN 'NY'\n            WHEN 'DELDOT' THEN 'DE'\n            WHEN 'DRBA' THEN 'DE'\n            WHEN 'ILTOLL' THEN 'IL'\n            WHEN 'ITRCC' THEN 'IN'\n            WHEN 'MASSDOT' THEN 'MA'\n            WHEN 'MDTA' THEN 'MD'\n            WHEN 'META' THEN 'ME'\n            WHEN 'MTAB&T' THEN 'NY'\n            WHEN 'NHDOT' THEN 'NH'\n            WHEN 'NYSBA' THEN 'NY'\n            WHEN 'NYSTA' THEN 'NY'\n            WHEN 'OTIC' THEN 'OH'\n            WHEN 'VDOT' THEN 'VA'\n            ELSE NULL  -- Unknown values become NULL\n        END as state_name,\n\n        -- Entry plaza name enrichment\n        CASE entry_plaza\n            -- GSP (Garden State Parkway)\n            WHEN 'PVK' THEN 'Pascack Valley'\n            WHEN 'PRS' THEN 'Paramus South'\n            WHEN 'PRN' THEN 'Paramus North'\n            WHEN 'BER' THEN 'Bergen'\n            WHEN 'SAB' THEN 'Saddle Brook'\n            WHEN 'CLS' THEN 'Clifton South'\n            WHEN 'CLN' THEN 'Clifton North'\n            WHEN 'PSS' THEN 'Passaic South'\n            WHEN 'PSN' THEN 'Passaic North'\n            WHEN 'WAS' THEN 'Watchung South'\n            WHEN 'WAN' THEN 'Watchung North'\n            WHEN 'ESS' THEN 'Essex'\n            WHEN 'BLS' THEN 'Bloomfield South'\n            WHEN 'BLN' THEN 'Bloomfield North'\n            WHEN 'EOR' THEN 'East Orange'\n            WHEN 'IRS' THEN 'Irvington South'\n            WHEN 'IRN' THEN 'Irvington North'\n            WHEN 'UNR' THEN 'Union Ramp'\n            WHEN 'UNI' THEN 'Union'\n            WHEN 'RAS' THEN 'Raritan South'\n            WHEN 'MAT' THEN 'Matawan'\n            WHEN 'KEY' THEN 'Keyport'\n            WHEN 'HOS' THEN 'Holmdel South'\n            WHEN 'HON' THEN 'Holmdel North'\n            WHEN 'RBS' THEN 'Red Bank South'\n            WHEN 'RBN' THEN 'Red Bank North'\n            WHEN 'EAT' THEN 'Eatontown'\n            WHEN 'ASP' THEN 'Asbury Park'\n            WHEN 'BES' THEN 'Belmar South'\n            WHEN 'BEN' THEN 'Belmar North'\n            WHEN 'BRS' THEN 'Brick South'\n            WHEN 'BRN' THEN 'Brick North'\n            WHEN 'LWS' THEN 'Lakewood South'\n            WHEN 'LWN' THEN 'Lakewood North'\n            WHEN 'TRV' THEN 'Toms River'\n            WHEN 'LRS' THEN 'Lacey Rd South'\n            WHEN 'LRN' THEN 'Lacey Rd North'\n            WHEN 'BAR' THEN 'Barnegat'\n            WHEN 'BKS' THEN 'Berkeley Ramp South'\n            WHEN 'BKN' THEN 'Berkeley Ramp North'\n            WHEN 'NGR' THEN 'New Gretna'\n            WHEN 'WRS' THEN 'Waretown South'\n            WHEN 'WRN' THEN 'Waretown North'\n            WHEN 'SPT' THEN 'Somers Point'\n            WHEN 'GEG' THEN 'Great Egg'\n            WHEN 'CMY' THEN 'Cape May'\n            WHEN 'WWS' THEN 'Wildwood South'\n            WHEN 'WWN' THEN 'Wildwood North'\n            WHEN 'SAY' THEN 'Sayreville'\n            -- NJTP (Turnpike)\n            WHEN '1' THEN 'Delaware Memorial Bridge'\n            WHEN '2' THEN 'Swedesboro/Chester'\n            WHEN '3' THEN 'Woodbury/S. Camden/NJ Aquarium'\n            WHEN '4' THEN 'Camden/Philadelphia/NJ Aquarium'\n            WHEN '5' THEN 'Burlington/Mt. Holly'\n            WHEN '6' THEN 'PA Turnpike/Florence'\n            WHEN '6A' THEN 'PA Turnpike/Florence'\n            WHEN '6B' THEN 'Rte. 130 Credit Ramp'\n            WHEN '7' THEN 'Bordentown/Trenton'\n            WHEN '7A' THEN 'I-195/Trenton/Shore Points'\n            WHEN '8' THEN 'Hightstown/Freehold'\n            WHEN '8A' THEN 'Jamesburg/Cranbury'\n            WHEN '9' THEN 'New Brunswick/Admin Bldg'\n            WHEN '10' THEN 'I-287/Metuchen/Edison Twsp'\n            WHEN '11' THEN 'GSP/Woodbridge/The Amboys'\n            WHEN '12' THEN 'Carteret/Rahway'\n            WHEN '13' THEN 'I-278/Eliz/Goethals/Verrazano'\n            WHEN '13A' THEN 'Newark Aprt/Elizabeth Seaport'\n            WHEN '14' THEN 'I-78/Newark Airport'\n            WHEN '14A' THEN 'Bayonne'\n            WHEN '14B' THEN 'Jersey City/Liberty State Park'\n            WHEN '14C' THEN 'Holland Tunnel'\n            WHEN '15E' THEN 'Newark/Jersey City'\n            WHEN '15W' THEN 'I-280/Newark/The Oranges'\n            WHEN '15X' THEN 'Secaucus Transfer Station'\n            WHEN '16E' THEN 'Lincoln Tunnel/NJ 3/Secaucus'\n            WHEN '16W' THEN 'Sprtsplx/NJ 3/Secaucus/Ruthrfrd'\n            WHEN '17' THEN 'Secaucus/US 46'\n            WHEN '18E' THEN 'Lincoln Tunnel/NJ 3/Secaucus'\n            WHEN '18W' THEN 'Geo Washington Br/US 46/I-80'\n            WHEN '19W' THEN 'Carlstadt'\n            -- SJ (South Jersey)\n            WHEN 'APL' THEN 'Pleasantville Mainline Barrier'\n            WHEN 'AR9' THEN 'Route 9'\n            WHEN 'APO' THEN 'Pomona'\n            WHEN 'ACY' THEN 'AC Airport'\n            WHEN 'AML' THEN 'Mays Landing'\n            WHEN 'A50' THEN 'Route 50'\n            WHEN 'AEH' THEN 'Egg Harbor Mainline Barrier'\n            WHEN 'AH' THEN 'Hammonton Ramp'\n            WHEN 'AWN' THEN 'Winslow Ramp'\n            WHEN 'AWL' THEN 'Williamstown Ramp'\n            WHEN 'ACK' THEN 'Cross Keys'\n            WHEN 'OCL' THEN 'Ocean City-Longport Bridge'\n            WHEN 'CIB' THEN 'Corsons Inlet Bridge'\n            WHEN 'TIB' THEN 'Townsends Inlet Bridge'\n            WHEN 'GSB' THEN 'Grassy Sound Bridge'\n            WHEN 'MTB' THEN 'Middle Thorofare Bridge'\n            -- DRPA\n            WHEN 'BRB' THEN 'Betsy Ross Br'\n            WHEN 'BFB' THEN 'Ben Franklin Br'\n            WHEN 'WWB' THEN 'Walt Whitman Br'\n            WHEN 'CBB' THEN 'Commodore Barry Br'\n            -- DRBA\n            WHEN 'DMB' THEN 'Delaware Memorial Br'\n            -- BCBC\n            WHEN 'TPB' THEN 'Tacony Palmyra Br'\n            WHEN 'BBB' THEN 'Burlington Bristol Br'\n            -- DRJTBC\n            WHEN 'T-M' THEN 'Trenton-Morrisville Br'\n            WHEN 'NHL' THEN 'New Hope-Lambertville Br'\n            WHEN 'I78' THEN 'I-78 Br'\n            WHEN 'E-P' THEN 'Easton-Phillipsburg Br'\n            WHEN 'P-C' THEN 'Portland-Columbia Br'\n            WHEN 'DWG' THEN 'Delaware Water Gap Br'\n            WHEN 'M-M' THEN 'Milford-Montague Br'\n            WHEN 'O78' THEN 'Interstate 78-ORT'\n            WHEN 'ODW' THEN 'Delaware Water Gap-ORT'\n            WHEN 'OSF' THEN 'Scudder Falls Br'\n            ELSE NULL  -- Unknown values become NULL\n        END as entry_plaza_name,\n        \n        -- Exit plaza name enrichment\n        CASE exit_plaza\n            -- GSP\n            WHEN 'PVK' THEN 'Pascack Valley'\n            WHEN 'PRS' THEN 'Paramus South'\n            WHEN 'PRN' THEN 'Paramus North'\n            WHEN 'BER' THEN 'Bergen'\n            WHEN 'SAB' THEN 'Saddle Brook'\n            WHEN 'CLS' THEN 'Clifton South'\n            WHEN 'CLN' THEN 'Clifton North'\n            WHEN 'PSS' THEN 'Passaic South'\n            WHEN 'PSN' THEN 'Passaic North'\n            WHEN 'WAS' THEN 'Watchung South'\n            WHEN 'WAN' THEN 'Watchung North'\n            WHEN 'ESS' THEN 'Essex'\n            WHEN 'BLS' THEN 'Bloomfield South'\n            WHEN 'BLN' THEN 'Bloomfield North'\n            WHEN 'EOR' THEN 'East Orange'\n            WHEN 'IRS' THEN 'Irvington South'\n            WHEN 'IRN' THEN 'Irvington North'\n            WHEN 'UNR' THEN 'Union Ramp'\n            WHEN 'UNI' THEN 'Union'\n            WHEN 'RAS' THEN 'Raritan South'\n            WHEN 'MAT' THEN 'Matawan'\n            WHEN 'KEY' THEN 'Keyport'\n            WHEN 'HOS' THEN 'Holmdel South'\n            WHEN 'HON' THEN 'Holmdel North'\n            WHEN 'RBS' THEN 'Red Bank South'\n            WHEN 'RBN' THEN 'Red Bank North'\n            WHEN 'EAT' THEN 'Eatontown'\n            WHEN 'ASP' THEN 'Asbury Park'\n            WHEN 'BES' THEN 'Belmar South'\n            WHEN 'BEN' THEN 'Belmar North'\n            WHEN 'BRS' THEN 'Brick South'\n            WHEN 'BRN' THEN 'Brick North'\n            WHEN 'LWS' THEN 'Lakewood South'\n            WHEN 'LWN' THEN 'Lakewood North'\n            WHEN 'TRV' THEN 'Toms River'\n            WHEN 'LRS' THEN 'Lacey Rd South'\n            WHEN 'LRN' THEN 'Lacey Rd North'\n            WHEN 'BAR' THEN 'Barnegat'\n            WHEN 'BKS' THEN 'Berkeley Ramp South'\n            WHEN 'BKN' THEN 'Berkeley Ramp North'\n            WHEN 'NGR' THEN 'New Gretna'\n            WHEN 'WRS' THEN 'Waretown South'\n            WHEN 'WRN' THEN 'Waretown North'\n            WHEN 'SPT' THEN 'Somers Point'\n            WHEN 'GEG' THEN 'Great Egg'\n            WHEN 'CMY' THEN 'Cape May'\n            WHEN 'WWS' THEN 'Wildwood South'\n            WHEN 'WWN' THEN 'Wildwood North'\n            WHEN 'SAY' THEN 'Sayreville'\n            -- NJTP\n            WHEN '1' THEN 'Delaware Memorial Bridge'\n            WHEN '2' THEN 'Swedesboro/Chester'\n            WHEN '3' THEN 'Woodbury/S. Camden/NJ Aquarium'\n            WHEN '4' THEN 'Camden/Philadelphia/NJ Aquarium'\n            WHEN '5' THEN 'Burlington/Mt. Holly'\n            WHEN '6' THEN 'PA Turnpike/Florence'\n            WHEN '6A' THEN 'PA Turnpike/Florence'\n            WHEN '6B' THEN 'Rte. 130 Credit Ramp'\n            WHEN '7' THEN 'Bordentown/Trenton'\n            WHEN '7A' THEN 'I-195/Trenton/Shore Points'\n            WHEN '8' THEN 'Hightstown/Freehold'\n            WHEN '8A' THEN 'Jamesburg/Cranbury'\n            WHEN '9' THEN 'New Brunswick/Admin Bldg'\n            WHEN '10' THEN 'I-287/Metuchen/Edison Twsp'\n            WHEN '11' THEN 'GSP/Woodbridge/The Amboys'\n            WHEN '12' THEN 'Carteret/Rahway'\n            WHEN '13' THEN 'I-278/Eliz/Goethals/Verrazano'\n            WHEN '13A' THEN 'Newark Aprt/Elizabeth Seaport'\n            WHEN '14' THEN 'I-78/Newark Airport'\n            WHEN '14A' THEN 'Bayonne'\n            WHEN '14B' THEN 'Jersey City/Liberty State Park'\n            WHEN '14C' THEN 'Holland Tunnel'\n            WHEN '15E' THEN 'Newark/Jersey City'\n            WHEN '15W' THEN 'I-280/Newark/The Oranges'\n            WHEN '15X' THEN 'Secaucus Transfer Station'\n            WHEN '16E' THEN 'Lincoln Tunnel/NJ 3/Secaucus'\n            WHEN '16W' THEN 'Sprtsplx/NJ 3/Secaucus/Ruthrfrd'\n            WHEN '17' THEN 'Secaucus/US 46'\n            WHEN '18E' THEN 'Lincoln Tunnel/NJ 3/Secaucus'\n            WHEN '18W' THEN 'Geo Washington Br/US 46/I-80'\n            WHEN '19W' THEN 'Carlstadt'\n            -- SJ\n            WHEN 'APL' THEN 'Pleasantville Mainline Barrier'\n            WHEN 'AR9' THEN 'Route 9'\n            WHEN 'APO' THEN 'Pomona'\n            WHEN 'ACY' THEN 'AC Airport'\n            WHEN 'AML' THEN 'Mays Landing'\n            WHEN 'A50' THEN 'Route 50'\n            WHEN 'AEH' THEN 'Egg Harbor Mainline Barrier'\n            WHEN 'AH' THEN 'Hammonton Ramp'\n            WHEN 'AWN' THEN 'Winslow Ramp'\n            WHEN 'AWL' THEN 'Williamstown Ramp'\n            WHEN 'ACK' THEN 'Cross Keys'\n            WHEN 'OCL' THEN 'Ocean City-Longport Bridge'\n            WHEN 'CIB' THEN 'Corsons Inlet Bridge'\n            WHEN 'TIB' THEN 'Townsends Inlet Bridge'\n            WHEN 'GSB' THEN 'Grassy Sound Bridge'\n            WHEN 'MTB' THEN 'Middle Thorofare Bridge'\n            -- DRPA\n            WHEN 'BRB' THEN 'Betsy Ross Br'\n            WHEN 'BFB' THEN 'Ben Franklin Br'\n            WHEN 'WWB' THEN 'Walt Whitman Br'\n            WHEN 'CBB' THEN 'Commodore Barry Br'\n            -- DRBA\n            WHEN 'DMB' THEN 'Delaware Memorial Br'\n            -- BCBC\n            WHEN 'TPB' THEN 'Tacony Palmyra Br'\n            WHEN 'BBB' THEN 'Burlington Bristol Br'\n            -- DRJTBC\n            WHEN 'T-M' THEN 'Trenton-Morrisville Br'\n            WHEN 'NHL' THEN 'New Hope-Lambertville Br'\n            WHEN 'I78' THEN 'I-78 Br'\n            WHEN 'E-P' THEN 'Easton-Phillipsburg Br'\n            WHEN 'P-C' THEN 'Portland-Columbia Br'\n            WHEN 'DWG' THEN 'Delaware Water Gap Br'\n            WHEN 'M-M' THEN 'Milford-Montague Br'\n            WHEN 'O78' THEN 'Interstate 78-ORT'\n            WHEN 'ODW' THEN 'Delaware Water Gap-ORT'\n            WHEN 'OSF' THEN 'Scudder Falls Br'\n            ELSE NULL  -- Unknown values become NULL\n        END as exit_plaza_name\n        \n    FROM cleaned\n    WHERE description = 'TOLL'\n)\n\nSELECT * FROM enriched\n),  __dbt__cte___silver__feateng as (\n\n\nWITH enriched AS (\n    SELECT * FROM __dbt__cte___silver__enrichment\n),\n\nnew_features AS (\n    SELECT\n        *,\n        -- Feature engineering\n        -- ============================================\n        -- TIME-BASED FEATURES\n        -- ============================================\n\n        -- Extract datetime components\n        EXTRACT(DAYOFWEEK FROM transaction_date) as transaction_dayofweek,  -- 1=Sun, 7=Sat\n        EXTRACT(DAYOFYEAR FROM transaction_date) as transaction_dayofyear,\n        FORMAT_DATE('%B', transaction_date) as transaction_month,\n        FORMAT_DATE('%A', transaction_date) as transaction_day,\n\n        -- Categorize days\n        CASE \n            WHEN EXTRACT(DAYOFWEEK FROM transaction_date) IN (1, 7) THEN 'Weekend'\n            ELSE 'Weekday'\n        END as is_weekend,\n\n        -- TIME OF DAY FEATURES\n        -- Entry time of day\n        CASE \n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 0 AND 5 THEN 'Night'\n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 6 AND 8 THEN 'Morning Rush'\n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 9 AND 11 THEN 'Morning'\n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 12 AND 14 THEN 'Midday'\n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 15 AND 18 THEN 'Evening Rush'\n            WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 19 AND 21 THEN 'Evening'\n            ELSE 'Late Night'\n        END as entry_time_of_day,\n\n        -- Exit time of day\n        CASE \n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 0 AND 5 THEN 'Night'\n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 6 AND 8 THEN 'Morning Rush'\n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 9 AND 11 THEN 'Morning'\n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 12 AND 14 THEN 'Midday'\n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 15 AND 18 THEN 'Evening Rush'\n            WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 19 AND 21 THEN 'Evening'\n            ELSE 'Late Night'\n        END as exit_time_of_day,\n\n        -- Combined journey category\n        CONCAT(\n            CASE \n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 0 AND 5 THEN 'Night'\n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 6 AND 8 THEN 'Morning Rush'\n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 9 AND 11 THEN 'Morning'\n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 12 AND 14 THEN 'Midday'\n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 15 AND 18 THEN 'Evening Rush'\n                WHEN EXTRACT(HOUR FROM entry_time) BETWEEN 19 AND 21 THEN 'Evening'\n                ELSE 'Late Night'\n            END,\n            ' to ',\n            CASE \n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 0 AND 5 THEN 'Night'\n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 6 AND 8 THEN 'Morning Rush'\n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 9 AND 11 THEN 'Morning'\n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 12 AND 14 THEN 'Midday'\n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 15 AND 18 THEN 'Evening Rush'\n                WHEN EXTRACT(HOUR FROM exit_time) BETWEEN 19 AND 21 THEN 'Evening'\n                ELSE 'Late Night'\n            END\n        ) as journey_time_of_day,  -- e.g., \"Morning Rush to Midday\"\n\n        -- Hour-by-hour patterns (0-23) \n        EXTRACT(HOUR FROM entry_time) as entry_hour,\n        EXTRACT(HOUR FROM exit_time) as exit_hour,\n        \n        -- Duration categories\n        CASE \n            WHEN TIMESTAMP_DIFF(exit_time, entry_time, MINUTE) IS NULL THEN ''\n            WHEN TIMESTAMP_DIFF(exit_time, entry_time, MINUTE) < 5 THEN 'Very Short (<5 min)'\n            WHEN TIMESTAMP_DIFF(exit_time, entry_time, MINUTE) < 15 THEN 'Short (5-15 min)'\n            WHEN TIMESTAMP_DIFF(exit_time, entry_time, MINUTE) < 30 THEN 'Medium (15-30 min)'\n            WHEN TIMESTAMP_DIFF(exit_time, entry_time, MINUTE) < 60 THEN 'Long (30-60 min)'\n            ELSE 'Very Long (60+ min)'\n        END as travel_duration_category,\n\n        -- ============================================\n        -- VEHICLE & USAGE FEATURES\n        -- ============================================\n        \n        -- Vehicle class category\n        CASE \n            WHEN vehicle_type_code IN ('1', '2', '2L', '2H') THEN 'Passenger Vehicle'\n            WHEN vehicle_type_code IN ('3', '3L', '3H', 'B2', 'B3') THEN 'Light Commercial'\n            WHEN vehicle_type_code IN ('4', '5', '6', '7', '8', '9', '4L', '4H', '5H', '6H', '7H') THEN 'Heavy Commercial'\n            ELSE 'Unknown'\n        END as vehicle_class_category,\n        \n        -- Daily Number of Transactions by tag_plate_number\n        COUNT(*) OVER (PARTITION BY tag_plate_number, transaction_date) AS daily_count\n\n    FROM enriched\n)\n\nSELECT * FROM new_features\n),  __dbt__cte___silver__flag as (\n\n\nWITH new_features AS (\n    SELECT * FROM __dbt__cte___silver__feateng\n),\n\nholidays AS (\n    SELECT * FROM `njc-ezpass`.`ezpass_data`.`holidays`\n),\n\nflagged AS (\n    SELECT\n        *,\n        -- ============================================\n        -- DATA QUALITY FLAGS\n        -- ============================================\n        \n        -- Missing data flags\n        CASE WHEN entry_plaza IS NULL THEN TRUE ELSE FALSE END as is_missing_entry,\n        CASE WHEN exit_plaza IS NULL THEN TRUE ELSE FALSE END as is_missing_exit,\n        CASE WHEN entry_time IS NULL THEN TRUE ELSE FALSE END as is_missing_entry_time,\n        CASE WHEN exit_time IS NULL THEN TRUE ELSE FALSE END as is_missing_exit_time,\n\n        -- Usage Outside Business flags\n        -- Checks if a given date is a weekend (Saturday or Sunday)\n        CASE is_weekend\n            WHEN 'Weekend' THEN TRUE\n            WHEN 'Weekday' THEN FALSE\n            ELSE NULL\n        END as flag_is_weekend,\n\n        -- Checks if a person has traveled from NJ to a neighboring state: NY, PA, DE and vice versa. Also flags people using tolls outside the state of NJ\n        CASE state_name\n            WHEN 'NJ' THEN FALSE\n            ELSE TRUE\n        END as flag_is_out_of_state,\n\n        -- Checks if the provided vehicle_class_code is larger than allowed\n        CASE vehicle_class_category\n            WHEN 'Light Commercial' THEN TRUE\n            WHEN 'Heavy Commercial' THEN TRUE\n            ELSE FALSE\n        END as flag_is_vehicle_type_gt2,\n\n        -- Checks if the provided transaction_date is considered a NJ Courts Holiday\n        CASE \n            WHEN EXISTS (\n                SELECT *\n                FROM holidays\n                WHERE holiday_date = transaction_date\n            ) THEN TRUE\n            ELSE FALSE\n        END AS flag_is_holiday\n\n    FROM new_features\n)\n\nSELECT * FROM flagged\n), silver_flag AS (\n    SELECT * FROM __dbt__cte___silver__flag\n)\n\nSELECT \n    -- Dates\n    transaction_date,\n    posting_date,\n    \n    -- Timestamps\n    entry_time,\n    exit_time,\n    \n    -- IDs\n    tag_plate_number,\n    agency,\n    agency_name,\n    description,\n    \n    -- Entry info\n    entry_plaza,\n    entry_plaza_name,\n    entry_lane,\n    \n    -- Exit info\n    exit_plaza,\n    exit_plaza_name,\n    exit_lane,\n    \n    -- Vehicle & fare\n    vehicle_type_code,\n    plan_rate,\n    fare_type,\n    \n    -- Financial\n    amount,\n    prepaid,\n    balance,\n    \n    -- New features\n    daily_count,\n    state_name,\n    transaction_dayofweek,\n    transaction_dayofyear,\n    transaction_month,\n    transaction_day,\n    entry_time_of_day,\n    exit_time_of_day,\n    journey_time_of_day,\n    entry_hour,\n    exit_hour,\n    travel_duration_category,\n    vehicle_class_category,\n\n    -- Flags\n    flag_is_weekend,\n    flag_is_out_of_state,\n    flag_is_vehicle_type_gt2,\n    flag_is_holiday,\n\n    -- Metadata (last)\n    loaded_at as last_updated,\n    source_file\n\nFROM silver_flag", "relation_name": "`njc-ezpass`.`ezpass_data`.`silver`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T06:54:26.913267Z", "completed_at": "2025-11-10T06:54:26.961007Z"}, {"name": "execute", "started_at": "2025-11-10T06:54:26.961574Z", "completed_at": "2025-11-10T06:54:32.201190Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.2922985553741455, "adapter_response": {"_message": "CREATE TABLE (17.9k rows, 2.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 17889, "bytes_processed": 2479811, "bytes_billed": 20971520, "location": "US", "project_id": "njc-ezpass", "job_id": "92f69b82-b568-45a3-8061-e2af2cef9f9f", "slot_ms": 23231}, "message": "CREATE TABLE (17.9k rows, 2.4 MiB processed)", "failures": null, "unique_id": "model.ezpass_dbt.gold", "compiled": true, "compiled_code": "\n\nWITH  __dbt__cte___gold__aggregation as (\n\n\nWITH source AS (\n    SELECT * FROM `njc-ezpass`.`ezpass_data`.`silver`\n),\n\naggregation AS (\n    SELECT \n        tag_plate_number,\n        transaction_date,\n        daily_count,\n        state_name,\n        agency,\n        agency_name,\n    \n        entry_time,\n        entry_plaza,\n        entry_plaza_name,\n\n        exit_time,\n        exit_plaza,\n        exit_plaza_name,\n\n        vehicle_type_code,\n        vehicle_class_category,\n\n        fare_type,\n        amount,\n\n        flag_is_weekend,\n        flag_is_out_of_state,\n        flag_is_vehicle_type_gt2,\n        flag_is_holiday,\n\n        last_updated,\n        source_file,\n    \n        ------Existing Features------\n        --plan_rate,\n        --prepaid,\n        --posting_date,\n        --description,\n        --entry_lane,\n        --exit_lane,\n\n        ------New Features------\n        --transaction_dayofweek,\n        --transaction_dayofyear,\n        --transaction_month,\n        --transaction_day,\n        --entry_time_of_day,\n        --exit_time_of_day,\n        --journey_time_of_day,\n        --entry_hour,\n        --exit_hour,\n        --travel_duration_category,\n\n    FROM source\n)\n\nSELECT * FROM aggregation\n),  __dbt__cte___gold__metrics as (\n\n\nWITH aggregation AS (\n    SELECT * FROM __dbt__cte___gold__aggregation\n),\n\nmetrics AS (\n    SELECT\n        *,\n        CASE\n            WHEN flag_is_vehicle_type_gt2 = TRUE THEN 'High'\n            WHEN flag_is_out_of_state = TRUE THEN 'Medium'\n            WHEN flag_is_weekend = TRUE THEN 'Low'\n            WHEN flag_is_holiday = TRUE THEN 'Low'\n        END as threat_severity,\n\n            \n        CASE \n            WHEN flag_is_weekend = TRUE\n            or flag_is_out_of_state = TRUE\n            or flag_is_vehicle_type_gt2 = TRUE\n            or flag_is_holiday = TRUE\n            THEN TRUE\n            ELSE FALSE\n        END as flag_fraud\n       \n    FROM aggregation\n)\n\nSELECT * FROM metrics\n), metrics AS (\n    SELECT * FROM __dbt__cte___gold__metrics\n)\n\nSELECT \n    tag_plate_number,\n        transaction_date,\n        daily_count,\n        state_name,\n        agency,\n        agency_name,\n    \n        entry_time,\n        entry_plaza,\n        entry_plaza_name,\n\n        exit_time,\n        exit_plaza,\n        exit_plaza_name,\n\n        vehicle_type_code,\n        vehicle_class_category,\n\n        fare_type,\n        amount,\n\n        flag_is_weekend,\n        flag_is_out_of_state,\n        flag_is_vehicle_type_gt2,\n        flag_is_holiday,\n        flag_fraud,\n        threat_severity,\n\n        last_updated,\n        source_file,\n    \n        ------Existing Features------\n        --plan_rate,\n        --prepaid,\n        --posting_date,\n        --description,\n        --entry_lane,\n        --exit_lane,\n\n        ------New Features------\n        --transaction_dayofweek,\n        --transaction_dayofyear,\n        --transaction_month,\n        --transaction_day,\n        --entry_time_of_day,\n        --exit_time_of_day,\n        --journey_time_of_day,\n        --entry_hour,\n        --exit_hour,\n        --travel_duration_category,\n\nFROM metrics", "relation_name": "`njc-ezpass`.`ezpass_data`.`gold`", "batch_results": null}], "elapsed_time": 8.417338371276855, "args": {"project_dir": "C:\\Users\\Eric\\Documents\\GitHub\\E-ZPass-Fraud-Detection\\ezpass_dbt", "exclude": [], "log_format": "default", "send_anonymous_usage_stats": true, "log_level": "info", "require_nested_cumulative_type_params": false, "print": true, "indirect_selection": "eager", "use_colors": true, "require_generic_test_arguments_property": true, "partial_parse_file_diff": true, "show_all_deprecations": false, "quiet": false, "source_freshness_run_project_hooks": true, "favor_state": false, "introspect": true, "log_file_max_bytes": 10485760, "require_batched_execution_for_custom_microbatch_strategy": false, "require_yaml_configuration_for_mf_time_spines": false, "select": [], "macro_debugging": false, "validate_macro_args": false, "which": "run", "defer": false, "log_format_file": "debug", "warn_error_options": {"error": [], "warn": [], "silence": []}, "log_level_file": "debug", "use_colors_file": true, "require_all_warnings_handled_by_warn_error": false, "profiles_dir": "C:\\Users\\Eric\\.dbt", "skip_nodes_if_on_run_start_fails": false, "vars": {}, "strict_mode": false, "write_json": true, "populate_cache": true, "log_path": "C:\\Users\\Eric\\Documents\\GitHub\\E-ZPass-Fraud-Detection\\ezpass_dbt\\logs", "use_fast_test_edges": false, "static_parser": true, "empty": false, "upload_to_artifacts_ingest_api": false, "cache_selected_only": false, "partial_parse": true, "printer_width": 80, "invocation_command": "dbt run", "state_modified_compare_vars": false, "require_resource_names_without_spaces": true, "require_explicit_package_overrides_for_builtin_materializations": true, "state_modified_compare_more_unrendered_values": false, "version_check": true, "show_resource_report": false}}