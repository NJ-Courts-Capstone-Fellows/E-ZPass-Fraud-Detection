---
config:
  layout: dagre
  look: classic
  theme: forest
---
flowchart TB
 subgraph subGraph0["External Data Sources"]
        A["ğŸ“§ E-ZPass Authority<br>Monthly Email System<br>"]
        B["ğŸ“® Gmail/Email Provider<br>IMAP Server<br>Port 993 SSL"]
  end
 subgraph subGraph1["ğŸ” Email Processing"]
        C["ğŸ“¡ Email Monitor<br>Node.js + IMAP<br>Check Daily"]
        D{"ğŸ“¬ New E-ZPass Email?"}
        E["â° Wait 24 Hours"]
        F["ğŸ“¥ Download CSV<br>~4K Records"]
        G["ğŸ” Parse & Validate CSV"]
        H{"âœ… Valid Format?"}
        I["ğŸš¨ Error Alert"]
        J["ğŸ·ï¸ Create Batch ID"]
  end
 subgraph subGraph2["ğŸ’¾ Database Storage"]
        K["ğŸ—„ï¸ PostgreSQL Database<br>Connection Pool: 5<br>localhost:5432"]
        L["ğŸ“ Insert 4K Transactions<br>Table: transactions"]
        M["ğŸ” Validate Data"]
        N["âš ï¸ Rollback"]
        O["âœ… Commit Batch"]
        P["ğŸš€ Start Fraud Analysis"]
  end
 subgraph subGraph3["ğŸ¤– Fraud Detection"]
        Q["âš™ï¸ ML Analysis Engine<br>Statistical Detection"]
        R["ğŸ’° Amount Check<br>Threshold: &gt;$50"]
        S["ğŸ“Š Frequency Check<br>Daily Limit: &gt;15"]
        T["â° Time Pattern<br>11PM-6AM Unusual"]
        U["ğŸ” Calculate Risk Score<br>0-100 Scale"]
        V["ğŸ’¾ Store Results<br>fraud_analysis table"]
  end
 subgraph subGraph4["ğŸ“§ Alert System"]
        W{"ğŸš¨ High Risk Found?<br>Score â‰¥ 80?"}
        X["ğŸ“¨ Send Alert Email<br>"]
        Y["ğŸ“‹ Log Alert Sent"]
        Z["âœ… Processing Complete"]
  end
 subgraph subGraph5["ğŸŒ API & Dashboard"]
        AA["ğŸ”— REST API Server<br>Express.js Port: 3001"]
        BB["ğŸ“‹ /transactions<br>Get All Data"]
        CC["ğŸ“Š /fraud-summary<br>Statistics"]
        DD["ğŸš¨ /high-risk<br>Flagged Cases"]
        EE["ğŸ“± React Dashboard<br>Port: 3000"]
        FF["ğŸ“‹ Transaction Table<br>Filter: All/Flagged"]
        GG["ğŸ“ˆ Summary Cards<br>Total/Fraud Count/Rate"]
        HH["ğŸ” Risk Analysis<br>Fraud Details"]
  end
 subgraph subGraph6["ğŸ“ˆ Simple Reporting"]
        II["ğŸ“… Monthly Report<br>Generate PDF Summary"]
        JJ["ğŸ“§ Email to Stakeholders<br>Monthly Statistics"]
  end
 subgraph subGraph7["â° Automation"]
        KK["ğŸ“§ Daily Email Check"]
        LL["ğŸš¨ Alert Processing<br>Real-time<br>When Fraud Detected"]
        MM["ğŸ“… Monthly Report<br>1st of Month"]
  end
%%  subgraph subGraph8["ğŸ“Š Performance Metrics"]
%%         NN["ğŸ“ˆ Processing Stats<br>â€¢ Email Check: Daily<br>â€¢ CSV Processing: &lt;2min<br>â€¢ Fraud Analysis: &lt;3min<br>â€¢ Total Monthly Volume: 4K<br>â€¢ Expected Fraud: ~200 cases"]
%%         OO["ğŸ¯ Business Value<br>â€¢ Monthly Processing: 4K transactions<br>â€¢ Fraud Detection: &gt;85% accuracy<br>â€¢ Alert Response: &lt;5 minutes<br>â€¢ Cost Savings: 20hrs/month<br>â€¢ Zero Manual Processing"]
%%   end
    A -- Sends Monthly CSV<br>~4,000 Transactions --> B
    B -- IMAP Connection --> C
    C --> D
    D -- âŒ No --> E
    E --> C
    D -- âœ… Found --> F
    F --> G
    G --> H
    H -- âŒ Invalid --> I
    H -- âœ… Valid --> J
    J --> K
    K --> L
    L --> M
    M -- âŒ Error --> N
    M -- âœ… Success --> O
    O --> P
    P --> Q
    Q --> R
    R --> S
    S --> T
    T --> U
    U --> V
    V --> W & AA
    W -- ğŸ”´ YES --> X
    X --> Y
    W -- âœ… Normal --> Z
    AA --> BB & CC & DD
    BB --> EE
    CC --> EE
    DD --> EE
    EE --> FF & GG & HH
    Y --> II
    II --> JJ
    KK --> C
    LL --> W
    MM --> II
     A:::external
     B:::external
     C:::processing
     D:::processing
     E:::processing
     F:::processing
     G:::processing
     H:::processing
     I:::processing
     J:::processing
     K:::database
     L:::database
     M:::database
     N:::database
     O:::database
     P:::ml
     Q:::ml
     R:::ml
     S:::ml
     T:::ml
     U:::ml
     V:::ml
     W:::alert
     X:::alert
     Y:::alert
     Z:::alert
     AA:::api
     BB:::api
     CC:::api
     DD:::api
     EE:::api
     FF:::api
     GG:::api
     HH:::api
     II:::reporting
     JJ:::reporting
     KK:::automation
     LL:::automation
     MM:::automation
    %%  NN:::metrics
    %%  OO:::metrics
    classDef external fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000
    classDef processing fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef database fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef ml fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef alert fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    classDef api fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:#000
    classDef reporting fill:#f1f8e9,stroke:#689f38,stroke-width:2px,color:#000
    classDef automation fill:#f9fbe7,stroke:#827717,stroke-width:2px,color:#000
    classDef metrics fill:#fff8e1,stroke:#ff8f00,stroke-width:2px,color:#000
